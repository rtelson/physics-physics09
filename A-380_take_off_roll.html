<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pierre Marie Curie Physics 9 â€“ Prof. Telson</title>
  <style>
    body {
      margin: 0;
      padding: 20px;
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
      overflow-x: hidden;
    }
    .header {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 24px;
    }
    .header img {
      width: 120px;
      height: 120px;
      margin-bottom: 12px;
    }
    .header h1 {
      margin: 0;
      font-size: 1.6em;
    }
    .scenario {
      text-align: center;
      margin-bottom: 8px;
    }
    .scenario p {
      margin: 0 0 4px;
      line-height: 1.4;
    }
    #speedDisplay {
      text-align: center;
      margin-bottom: 16px;
      font-weight: bold;
    }
    #takeoffResult {
      text-align: center;
      font-weight: bold;
      margin-top: 16px;
    }
    #runway {
      display: block;
      width: 100%;
      height: 300px;
      border: 1px solid #999;
      background: #eee;
      border-radius: 8px;
    }
  </style>
</head>
<body>

  <!-- Header -->
  <div class="header">
    <img src="logo.svg" alt="School Logo" />
    <h1 style="margin: 0;">Pierre Marie Curie Physics 9 â€“ Prof. Telson</h1>
  </div>

  <!-- Scenario & Inputs -->
  <div class="scenario">
    <h2>A-380 Take-Off Roll</h2>
    <p>Runway length: <strong>4 600 m</strong></p>
    <p>Take-off speed: <strong>290 km/h</strong></p>
    <p>Acceleration (roll): <strong>1 m/sÂ²</strong></p>
    <p>Acceleration (flight): <strong>2 m/sÂ²</strong></p>
  </div>

  <!-- Dynamic speed -->
  <div id="speedDisplay">Current speed: 0.0 m/s</div>

  <div class="scenario">
    <label for="studentTime">Your answer (s):</label>
    <input type="number" id="studentTime" step="0.1" style="width:80px" />
    <button onclick="simulateTakeoff()">Submit</button>
  </div>

  <!-- Outcome -->
  <div id="takeoffResult"></div>

  <!--x  Canvas -->
  <canvas id="runway" height="300"></canvas>

  <script>
    const canvas     = document.getElementById('runway');
    const ctx        = canvas.getContext('2d');
    let studentTime  = 0;
    let startTS      = null;

    // Constants
    const vKmh        = 290;
    const vMs         = vKmh * 1000 / 3600;   // â‰ˆ80.56 m/s
    const a1          = 1;                    // roll accel
    const a2          = 2;                    // flight accel
    const correctTime = vMs / a1;             // â‰ˆ80.56 s
    const runwayLen   = 4600;                 // m
    const rotDur      = 15;                   // s to rotate 45Â°
    const flightDur   = 9;                    // s after lift-off
    const spinRate    = 2 * Math.PI;          // rad/s tumble

    function resizeCanvas() {
      canvas.width = canvas.clientWidth;
    }
    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function drawTaxiways() {
      const yMid      = canvas.height / 2;
      const offset    = 80;
      const thickness = 16;
      ctx.fillStyle   = '#666';
      // upper taxiway
      ctx.fillRect(0, yMid - offset - thickness/2,
                   canvas.width, thickness);
      // lower taxiway
      ctx.fillRect(0, yMid + offset - thickness/2,
                   canvas.width, thickness);
      // center connector
      ctx.fillRect(
        canvas.width/2 - thickness/2,
        yMid - offset - thickness/2,
        thickness,
        2*offset + thickness
      );
    }


    function drawRunwayMarkings() {
      const yMid      = canvas.height / 2;
      const stripeW   = 8;
      const stripeH   = 20;
      const gap       = 12;
      const count     = 8;
      // shift 25% + ~200px to the right
      const baseX     = 20;
      ctx.fillStyle   = 'white';
      for (let i = 0; i < count; i++) {
        ctx.fillRect(
          baseX + i * (stripeW + gap),
          yMid - stripeH/2,
          stripeW,
          stripeH
        );
      }
      ctx.fillStyle = 'white';
      ctx.font       = '24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText(
        '09',
        baseX + (count * (stripeW + gap)) / 2,
        yMid - 30
      );
    }

    function drawVASILights() {
      const yMid     = canvas.height / 2;
      const size     = 12;
      const x        = 100;
      const offsets  = [-20, -8, 8, 20];
      const colors   = ['white','white','red','red'];
      for (let i = 0; i < 4; i++) {
        ctx.fillStyle = colors[i];
        ctx.fillRect(
          x,
          yMid + offsets[i] - size/2,
          size,
          size
        );
        ctx.strokeStyle = '#000';
        ctx.strokeRect(
          x,
          yMid + offsets[i] - size/2,
          size,
          size
        );
      }
    }

    function drawRunway() {
      const yMid = canvas.height / 2;
      // base strip
      ctx.fillStyle = '#444';
      ctx.fillRect(0, yMid - 12,
                   canvas.width, 24);
      // centerline
      ctx.strokeStyle = '#fff';
      ctx.lineWidth   = 4;
      ctx.setLineDash([40,30]);
      ctx.beginPath();
      ctx.moveTo(0, yMid);
      ctx.lineTo(canvas.width, yMid);
      ctx.stroke();
      ctx.setLineDash([]);
      drawRunwayMarkings();
      drawVASILights();
    }

    function drawPlane(x, y, angle, onFire) {
      const size = 30;
      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(angle);
      ctx.beginPath();
      ctx.moveTo(-size, -size/2);
      ctx.lineTo( size,    0);
      ctx.lineTo(-size,  size/2);
      ctx.closePath();
      ctx.fillStyle = 'blue';
      ctx.fill();
      if (onFire) {
        for (let i = 0; i < 5; i++) {
          ctx.fillStyle = i % 2 ? 'orange' : 'red';
          ctx.beginPath();
          ctx.arc(
            -size - i*6,
            i*3,
            size - i*2,
            0,
            2*Math.PI
          );
          ctx.fill();
        }
      }
      ctx.restore();
    }

    function drawHUD(t, v, dist) {
      ctx.fillStyle = '#000';
      ctx.font       = '16px Arial';
      ctx.fillText(`t: ${t.toFixed(1)} s`,    202, 20);
      ctx.fillText(`v: ${v.toFixed(1)} m/s`,   202, 40);
      ctx.fillText(`d: ${dist.toFixed(1)} m`,  202, 60);
    }

    function showOutcome() {
      const out = document.getElementById('takeoffResult');
      if (studentTime < correctTime*0.9 ||
          studentTime > correctTime*1.1
      ) {
        out.textContent = 'Incorrect timeâ€”ðŸ”¥';
      } else {
        out.textContent = 'Perfect lift-off ðŸŽ‰';
      }
    }

    function animate(ts) {
      if (!startTS) startTS = ts;
      const tTotal = (ts - startTS) / 1000;
      const yMid   = canvas.height / 2;
      const pxPerM = canvas.width / runwayLen;

      // Roll phase
      const tRoll   = Math.min(tTotal, studentTime);
      const dist1   = 0.5 * a1 * tRoll * tRoll;
      const vRoll   = a1 * tRoll;
      const xRollPx = dist1 * pxPerM;

      if (tTotal <= studentTime) {
        document.getElementById('speedDisplay').textContent =
          `Current speed: ${vRoll.toFixed(1)} m/s`;
      }

      let x      = xRollPx;
      let y      = yMid;
      let v      = vRoll;
      let dist   = dist1;
      let angle  = 0;
      let onFire = false;

      // Flight or tumble
      if (tTotal > studentTime) {
        const tFlight = tTotal - studentTime;
        const fails   = (studentTime < correctTime*0.9 ||
                         studentTime > correctTime*1.1);
        if (fails) {
          // tumble on runway
          angle  = tFlight * spinRate;
          onFire = true;
        } else {
          // smooth climb
          const alpha = Math.min(tFlight / rotDur, 1);
          angle = -alpha * Math.PI / 4;
          const dist2 = vRoll*tFlight + 0.5*a2*tFlight*tFlight;
          const v2    = vRoll + a2*tFlight;
          x = xRollPx +
              dist2 * pxPerM * Math.cos(Math.PI / 4);
          y = yMid -
              dist2 * pxPerM * Math.sin(Math.PI / 4);
          v = v2;
          dist = dist1 + dist2;
        }
        document.getElementById('speedDisplay').textContent = '';
      }

      ctx.clearRect(0, 0, canvas.width, canvas.height);
      drawTaxiways();
      drawRunway();
      drawPlane(x, y, angle, onFire);
      drawHUD(tTotal, v, dist);

      if (tTotal < studentTime + flightDur) {
        requestAnimationFrame(animate);
      } else {
        showOutcome();
      }
    }

    function simulateTakeoff() {
      const input = parseFloat(
        document.getElementById('studentTime').value
      );
      if (isNaN(input) || input <= 0) {
        alert('Enter a valid positive number of seconds.');
        return;
      }
      studentTime = input;
      startTS     = null;
      document.getElementById('takeoffResult').textContent = '';
      requestAnimationFrame(animate);
    }
  </script>

</body>
</html>
