<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Physics IV: Particles in Motion in a Glass Sphere Simulation</title>
<style>
  body { margin:0; font-family:sans-serif; background:#111; color:#fff; }
  canvas { display:block; background:#000; }

  .header {
    position:absolute; top:0; left:0; width:100%;
    display:flex; justify-content:space-between; align-items:center;
    background:#222; padding:10px 20px; box-sizing:border-box;
  }
  .header .title { font-size:18px; font-weight:bold; line-height:1.4; }
  .header img { height:50px; width:auto; }

  .controls {
    position:absolute; top:80px; left:10px;
    background:#222; padding:10px; border-radius:6px;
  }
  .row { margin:6px 0; }
  .btns { margin-top:8px; }
  .stats { display:flex; flex-wrap:wrap; margin-top:10px; }
  .card { background:#333; padding:6px 10px; margin:4px;
          border-radius:4px; flex:1; min-width:120px; }
  .small { font-size:12px; color:#aaa; }
  .big { font-size:18px; font-weight:bold; }
</style>
</head>
<body>
<canvas id="sim"></canvas>

<div class="header">
  <div class="title">
    Physics IV: Particles in Motion in a Glass Sphere Simulation<br>
    Dr. Telson
  </div>
  <img src="logo.svg" alt="School Logo">
</div>

<div class="controls">
  <div class="row">
    <label>Particles: <span id="nOut">50</span></label>
    <input id="nRange" type="range" min="10" max="200" step="10" value="50" />
  </div>
  <div class="row">
    <label>Temperature (speed scale): <span id="tempOut">1.00</span>x</label>
    <!-- min now 0.0 -->
    <input id="tempRange" type="range" min="0.0" max="3" step="0.1" value="1.0" />
  </div>
  <div class="row">
    <label>Particle size: <span id="rOut">4</span> px</label>
    <input id="rRange" type="range" min="2" max="10" step="1" value="4" />
  </div>

  <div class="btns">
    <button id="pauseBtn">Pause</button>
    <button id="resetBtn">Reset</button>
  </div>

  <div class="row stats">
    <div class="card"><div class="small">Pressure (relative)</div><div class="big" id="pressureOut">0.000</div></div>
    <div class="card"><div class="small">Temperature (relative)</div><div class="big" id="tempRelOut">0.000</div></div>
    <div class="card"><div class="small">Collisions / s</div><div class="big" id="collRateOut">0.0</div></div>
    <div class="card"><div class="small">Avg speed</div><div class="big" id="avgSpeedOut">0.0</div></div>
    <div class="card"><div class="small">kT scale</div><div class="big" id="kTscaleOut">1.00</div></div>
  </div>
</div>

<script>
const canvas = document.getElementById("sim");
const ctx = canvas.getContext("2d");
resize();
window.addEventListener("resize", resize);

let particles = [];
let r = 4;
const boxSize = 400;

let collisions = 0;
let lastCollTime = performance.now();
let paused = false;
let tempScale = 1.0;

// fixed offset from top so container always visible
const topOffset = 120;

function initParticles() {
  const n = parseInt(document.getElementById("nRange").value);
  particles = [];
  for (let i=0; i<n; i++) {
    let angle = Math.random()*2*Math.PI;
    let speed = tempScale * (2 + Math.random()*2);
    particles.push({
      x: Math.random()*(boxSize-2*r)+r,
      y: Math.random()*(boxSize-2*r)+r,
      vx: Math.cos(angle)*speed,
      vy: Math.sin(angle)*speed
    });
  }
}
initParticles();

function resize() {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}

function update() {
  let totalSpeed = 0, totalSpeedSq = 0;
  let wallImpulses = 0;
  const n = particles.length;

  for (let p of particles) {
    p.x += p.vx;
    p.y += p.vy;

    if (p.x < r) { p.x = r; p.vx *= -1; wallImpulses += Math.abs(p.vx); collisions++; }
    if (p.x > boxSize - r) { p.x = boxSize - r; p.vx *= -1; wallImpulses += Math.abs(p.vx); collisions++; }
    if (p.y < r) { p.y = r; p.vy *= -1; wallImpulses += Math.abs(p.vy); collisions++; }
    if (p.y > boxSize - r) { p.y = boxSize - r; p.vy *= -1; wallImpulses += Math.abs(p.vy); collisions++; }

    let speed = Math.sqrt(p.vx*p.vx + p.vy*p.vy);
    totalSpeed += speed;
    totalSpeedSq += speed*speed;
  }

  let avgSpeed = totalSpeed / n;
  let relTemp = totalSpeedSq / n;

  document.getElementById("avgSpeedOut").textContent = avgSpeed.toFixed(2);
  document.getElementById("tempRelOut").textContent = relTemp.toFixed(2);

  let now = performance.now();
  let elapsed = (now - lastCollTime) / 1000;
  if (elapsed >= 1) {
    document.getElementById("collRateOut").textContent = (collisions / elapsed).toFixed(1);
    collisions = 0;
    lastCollTime = now;
  }

  document.getElementById("pressureOut").textContent = (wallImpulses / n).toFixed(3);
}

function draw() {
  ctx.clearRect(0,0,canvas.width,canvas.height);
  ctx.save();
  ctx.translate((canvas.width-boxSize)/2, topOffset);

  ctx.strokeStyle = "#fff";
  ctx.lineWidth = 3;
  ctx.strokeRect(0,0,boxSize,boxSize);

  ctx.fillStyle = "cyan";
  for (let p of particles) {
    ctx.beginPath();
    ctx.arc(p.x,p.y,r,0,2*Math.PI);
    ctx.fill();
  }
  ctx.restore();
}

function loop() {
  requestAnimationFrame(loop);
  if (!paused) update();
  draw();
}
loop();

// controls
document.getElementById("nRange").addEventListener("input", e=>{
  document.getElementById("nOut").textContent = e.target.value;
  initParticles();
});

document.getElementById("tempRange").addEventListener("input", e=>{
  tempScale = parseFloat(e.target.value);
  document.getElementById("tempOut").textContent = tempScale.toFixed(2);
  document.getElementById("kTscaleOut").textContent = tempScale.toFixed(2);

  if (tempScale === 0) {
    for (let p of particles) { p.vx = 0; p.vy = 0; }
    document.getElementById("avgSpeedOut").textContent = "0.000";
    document.getElementById("tempRelOut").textContent = "0.000";
    document.getElementById("pressureOut").textContent = "0.000";
    document.getElementById("collRateOut").textContent = "0.0";
  } else {
    initParticles();
  }
});

document.getElementById("rRange").addEventListener("input", e=>{
  r = parseInt(e.target.value);
  document.getElementById("rOut").textContent = r;
  initParticles();
});

document.getElementById("pauseBtn").addEventListener("click", e=>{
  paused = !paused;
  e.target.textContent = paused ? "Resume" : "Pause";
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  initParticles();
});
</script>
</body>
</html>
